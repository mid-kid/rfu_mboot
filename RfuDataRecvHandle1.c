#if 1
__asm__("
.section .text
.global RfuDataRecvHandle1
.type RfuDataRecvHandle1, function
.thumb_func
RfuDataRecvHandle1:
.2byte 0xb5f0,0x4657,0x464e,0x4645,0xb4e0,0xb081,0x1c16,0x0600,0x0e00,0x0609,0x0e09,0x4689,0x00c1,0x1a09,0x0109,0x4a2c,0x1889,0x468c,0x8808,0x4682,0x4660,0x3021,0x7931,0x1840,0x7800,0x9000,0x78b1,0x2902,0xd102,0x4826,0x4582,0xd00c,0x2901,0xd102,0x4824,0x4582,0xd007,0x221b,0x4462,0x4690,0x2903,0xd114,0x4821,0x4582,0xd111,0x7931,0x4660,0x3021,0x1840,0x7800,0x231b,0x4463,0x4698,0x7977,0x42b8,0xd106,0x1858,0x2101,0x464a,0x4091,0x7802,0x4311,0x7001,0x7932,0x4643,0x1898,0x7800,0x4667,0x7eb9,0x4008,0x4288,0xd176,0x4663,0x3321,0x189a,0x7810,0x3001,0x2103,0x4008,0x2100,0x7010,0x7930,0x4440,0x7001,0x8839,0x4a0d,0x1888,0x0400,0x0c00,0x1c1d,0x2801,0xd85b,0x4807,0x4281,0xd112,0x7931,0x0089,0x3b1d,0x1859,0x8dfa,0x6808,0x1880,0x6008,0xe014,0x5f00,0x0300,0x8022,0x0000,0x8021,0x0000,0x8023,0x0000,0x7fdf,0x0000,0x7932,0x0092,0x4663,0x3304,0x189a,0x4667,0x8df9,0x0089,0x6810,0x1840,0x6010,0x1c1c,0x4660,0x8dc1,0x6940,0x1a40,0x4661,0x6148,0x2800,0xd001,0x2800,0xda36,0x4660,0x3020,0x2200,0x7002,0x4663,0x8819,0x480d,0x4281,0xd11c,0x2300,0x18e8,0x2701,0x7007,0x0099,0x1861,0x4662,0x8dd0,0x1c02,0x435a,0x4667,0x6ab8,0x1880,0x6008,0x1c58,0x0600,0x0e03,0x2b03,0xd9ed,0x6b38,0x6178,0x4802,0x8038,0xe015,0x0000,0x8021,0x0000,0x8022,0x0000,0x702a,0x4660,0x6142,0x4802,0x4661,0x8008,0xe009,0x0000,0x8023,0x0000,0x0409,0x4818,0x4281,0xd102,0x4817,0x4662,0x8010,0x4663,0x8818,0x4550,0xd110,0x7932,0x4660,0x3021,0x1880,0x7800,0x9f00,0x42b8,0xd108,0x4641,0x1888,0x7800,0x464a,0x4110,0x2101,0x4008,0x2800,0xd00d,0x4a0c,0x2001,0x464b,0x4098,0x7991,0x4308,0x2100,0x7190,0x00d8,0x1ac0,0x0100,0x4f08,0x19c0,0x8041,0xb001,0xbc38,0x4698,0x46a1,0x46aa,0xbcf0,0xbc01,0x4700,0x0000,0x8023,0x8020,0x0000,0x6180,0x0300,0x5f00,0x0300
.size RfuDataRecvHandle1, .-RfuDataRecvHandle1
");
#else

#include <Agb.h>

#include "RfuPeer.h"
#include "MbootTmp.h"
extern struct RfuPeer RfuPeers[4];
extern struct MbootTmp MbootTmp;

void RfuDataRecvHandle1(u8 param_1, u8 param_2, u8 *param_3)
{
    u8 x;
    struct RfuPeerSub *sub;
    u16 save_unk_01;
    u8 save_unk_12;

    sub = &RfuPeers[param_1].sub[0];
    save_unk_01 = sub->unk_01[0];
    save_unk_12 = sub->unk_12[param_3[4]];

    if ((param_3[2] == 2 && sub->unk_01[0] == 0x8022) ||
            (param_3[2] == 1 && sub->unk_01[0] == 0x8021) ||
            (param_3[2] == 3 && sub->unk_01[0] == 0x8023)) {
        if (sub->unk_12[param_3[4]] == param_3[5]) {
            sub->unk_06[param_3[4]] |= 1 << param_2;
        }
    }

    if ((sub->unk_06[param_3[4]] & sub->unk_05) == sub->unk_05) {
        sub->unk_12[param_3[4]] = (sub->unk_12[param_3[4]] + 1) & 3;
        sub->unk_06[param_3[4]] = 0;

        if (sub->unk_01[0] == 0x8021 ||
                sub->unk_01[0] == 0x8022) {
            if (sub->unk_01[0] == 0x8021) {
                sub->unk_02[param_3[4]] += sub->unk_21;
            } else {
                sub->unk_02[param_3[4]] += sub->unk_21 * 4;
            }
            sub->unk_03 -= sub->unk_21;
            if (sub->unk_03 != 0 && sub->unk_03 < sub->unk_21) {
                sub->unk_11 = 0;
                if (sub->unk_01[0] == 0x8021) {
                    for (x = 0; x < 4; x++) {
                        sub->unk_12[x] = 1;
                        sub->unk_02[x] = &sub->unk_18[sub->unk_21 * x];
                    }
                    sub->unk_03 = sub->unk_22;
                    sub->unk_01[0] = 0x8022;
                } else {
                    sub->unk_12[0] = 0;
                    sub->unk_03 = 0;
                    sub->unk_01[0] = 0x8023;
                }
            }
        } else if (sub->unk_01[0] == 0x8023) {
            sub->unk_01[0] = 0x8020;
        }
    }

    if (sub->unk_01[0] != save_unk_01 ||
            sub->unk_12[param_3[4]] != save_unk_12 ||
            sub->unk_06[param_3[4]] & 1 << param_2) {
        MbootTmp.unk_07 |= 1 << param_2;
        RfuPeers[param_2].sub[0].unk_01[1] = 0;
    }
}
#endif
